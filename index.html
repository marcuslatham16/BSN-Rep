<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document Repository</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,400..700,0..1,0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="sidebar" id="sidebar">
    <div class="logo">
      <span class="material-symbols-outlined">folder</span>
      <h2>DocRepo</h2>
    </div>
    <nav>
      <div class="sidebar-item active">
        <span class="material-symbols-outlined">home</span> 
        <span>Home</span>
      </div>
      <div class="sidebar-item">
        <span class="material-symbols-outlined">workspaces</span> 
        <span>Projects</span>
      </div>
      <div class="sidebar-item">
        <span class="material-symbols-outlined">area_chart</span> 
        <span>Reports</span>
      </div>
      <div class="sidebar-item">
        <span class="material-symbols-outlined">tune</span> 
        <span>Settings</span>
      </div>
    </nav>
  </div>

  <div class="content-wrapper">
    <header>
      <button id="menu-toggle" class="menu-toggle">
        <span class="material-symbols-outlined">menu</span>
      </button>
      
      <div class="header-inner">
        <div class="breadcrumb" id="breadcrumb">
          <span class="material-symbols-outlined">folder</span>
          Home / Projects
        </div>
        
        <div class="header-actions">
          <div class="search-bar">
            <span class="material-symbols-outlined">search</span>
            <input type="text" id="searchInput" placeholder="Search projects" oninput="renderProjects()" />
          </div>
          <button class="create-btn" onclick="openProjectDialog()" title="Create New Project">
            <span class="material-symbols-outlined">add</span>
          </button>
          <div class="user-info">
            <span class="material-symbols-outlined">account_circle</span>
            <div class="user-details">
              <strong>User Name</strong>
              <small>Admin</small>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="content-header">
        <h1>Projects</h1>
        <p class="subtitle">Manage your document repositories</p>
      </div>
      
      <div id="projects-container">
        <div id="project-grid"></div>
      </div>
    </main>
  </div>

  <dialog id="projectDialog">
    <h2 id="dialogTitle">New Project</h2>
    <form id="projectForm">
      <div class="form-group">
        <label for="projectNameInput">Project Name</label>
        <input type="text" id="projectNameInput" placeholder="Enter project name" />
        <div id="nameError" class="error-message">Project name is required.</div>
      </div>
      
      <div class="form-group">
        <label for="projectDescInput">Description</label>
        <textarea id="projectDescInput" placeholder="Enter description"></textarea>
      </div>
      
      <div class="form-group">
        <label for="projectOwnerInput">Project Owner</label>
        <input type="text" id="projectOwnerInput" placeholder="Enter owner name" />
        <div id="ownerError" class="error-message">Project owner is required.</div>
      </div>
      
      <div class="form-group">
        <label for="projectDateInput">Date Created</label>
        <input type="date" id="projectDateInput" />
      </div>
      
      <div class="dialog-actions">
        <button type="button" id="saveBtn">
          <span class="material-symbols-outlined">save</span>
          <span id="saveBtnText">Create</span>
        </button>
        <button type="button" onclick="closeProjectDialog()">
          <span class="material-symbols-outlined">close</span>
          Cancel
        </button>
      </div>
    </form>
  </dialog>
  
  <dialog id="folderDialog">
    <h2>New Folder</h2>
    <form id="folderForm">
      <div class="form-group">
        <label for="folderNameInput">Folder Name</label>
        <input type="text" id="folderNameInput" placeholder="Enter folder name" />
        <div id="folderNameError" class="error-message">Folder name is required.</div>
      </div>
      
      <div class="dialog-actions">
        <button type="button" id="createFolderBtn">
          <span class="material-symbols-outlined">create_new_folder</span>
          <span>Create Folder</span>
        </button>
        <button type="button" id="cancelFolderBtn">
          <span class="material-symbols-outlined">close</span>
          <span>Cancel</span>
        </button>
      </div>
    </form>
  </dialog>
  
  <dialog id="fileUploadDialog">
    <h2>Upload Files</h2>
    <form id="fileUploadForm">
      <div class="form-group">
        <label for="fileInput">Select Files</label>
        <div class="file-upload-container">
          <input type="file" id="fileInput" multiple />
          <button type="button" class="file-select-btn">
            <span class="material-symbols-outlined">upload_file</span>
            <span>Choose Files</span>
          </button>
        </div>
        <div id="selectedFiles" class="selected-files"></div>
      </div>
      
      <div class="dialog-actions">
        <button type="button" id="uploadFilesBtn">
          <span class="material-symbols-outlined">cloud_upload</span>
          <span>Upload</span>
        </button>
        <button type="button" id="cancelUploadBtn">
          <span class="material-symbols-outlined">close</span>
          <span>Cancel</span>
        </button>
      </div>
    </form>
  </dialog>

  <script>
    const STORAGE_KEY = "projectRepository";
    let projects = [];
    let editingIndex = null;

    function loadProjects() {
      const data = localStorage.getItem(STORAGE_KEY);
      if (data) {
        projects = JSON.parse(data);
      } else {
        // Add sample projects for first-time users
        const today = new Date().toISOString().split('T')[0]; // Current date in YYYY-MM-DD format
        projects = [
          {
            name: "Marketing Campaign",
            description: "Files and assets for Q2 marketing campaign",
            owner: "Sarah Johnson",
            dateCreated: today,
            folders: [
              {
                folderName: "Social Media",
                files: ["facebook_ad.png", "instagram_post.psd", "twitter_banner.jpg"]
              }
            ]
          },
          {
            name: "Product Launch",
            description: "Documentation for the new product line",
            owner: "Michael Chen",
            dateCreated: today,
            folders: [
              {
                folderName: "Research",
                files: ["market_analysis.pdf", "competitor_review.docx"]
              }
            ]
          }
        ];
        saveProjects();
      }
    }

    function saveProjects() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(projects));
    }

    function openProjectDialog(isEdit = false, index = null) {
      document.getElementById("projectDialog").showModal();
      document.getElementById("dialogTitle").textContent = isEdit ? "Edit Project" : "Create New Project";
      document.getElementById("saveBtnText").textContent = isEdit ? "Save" : "Create";

      // Set today's date as default for new projects
      if (!isEdit) {
        document.getElementById("projectDateInput").value = new Date().toISOString().split('T')[0];
      }

      if (isEdit && projects[index]) {
        document.getElementById("projectNameInput").value = projects[index].name;
        document.getElementById("projectDescInput").value = projects[index].description;
        document.getElementById("projectOwnerInput").value = projects[index].owner;
        document.getElementById("projectDateInput").value = projects[index].dateCreated || new Date().toISOString().split('T')[0];
        editingIndex = index;
      } else {
        clearForm();
        editingIndex = null;
      }
    }

    function closeProjectDialog() {
      document.getElementById("projectDialog").close();
      clearForm();
      editingIndex = null;
    }

    function clearForm() {
      document.getElementById("projectNameInput").value = "";
      document.getElementById("projectDescInput").value = "";
      document.getElementById("projectOwnerInput").value = "";
      document.getElementById("projectDateInput").value = new Date().toISOString().split('T')[0];
      document.getElementById("nameError").style.display = "none";
      document.getElementById("ownerError").style.display = "none";
    }

    function handleSaveProject() {
      const name = document.getElementById("projectNameInput").value.trim();
      const desc = document.getElementById("projectDescInput").value.trim();
      const owner = document.getElementById("projectOwnerInput").value.trim();
      const dateCreated = document.getElementById("projectDateInput").value;

      const nameError = document.getElementById("nameError");
      const ownerError = document.getElementById("ownerError");

      nameError.style.display = name ? "none" : "block";
      ownerError.style.display = owner ? "none" : "block";

      if (!name || !owner) return;

      if (editingIndex !== null) {
        projects[editingIndex] = { 
          ...projects[editingIndex], 
          name, 
          description: desc, 
          owner, 
          dateCreated 
        };
      } else {
        projects.push({ 
          name, 
          description: desc, 
          owner, 
          dateCreated,
          folders: [] 
        });
      }

      saveProjects();
      renderProjects();
      closeProjectDialog();
    }

    function deleteProject(index) {
      const projectModal = document.createElement('dialog');
      projectModal.className = 'confirmation-dialog';
      
      projectModal.innerHTML = `
        <div class="confirmation-content">
          <span class="material-symbols-outlined warning-icon">warning</span>
          <h3>Delete Project?</h3>
          <p>Are you sure you want to delete "${projects[index].name}"? This action cannot be undone.</p>
          <div class="dialog-actions">
            <button class="delete-btn" id="confirmDelete">
              <span class="material-symbols-outlined">delete</span>
              Delete
            </button>
            <button class="secondary-btn" id="cancelDelete">
              <span class="material-symbols-outlined">close</span>
              Cancel
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(projectModal);
      projectModal.showModal();
      
      document.getElementById('confirmDelete').addEventListener('click', () => {
        projects.splice(index, 1);
        saveProjects();
        renderProjects();
        projectModal.close();
        document.body.removeChild(projectModal);
      });
      
      document.getElementById('cancelDelete').addEventListener('click', () => {
        projectModal.close();
        document.body.removeChild(projectModal);
      });
    }

    function renderProjects() {
      const container = document.getElementById("project-grid");
      const filter = document.getElementById("searchInput").value.toLowerCase();
      container.innerHTML = "";

      const visible = projects.filter(p => p.name.toLowerCase().includes(filter));

      if (!visible.length) {
        container.innerHTML = `
          <div class="empty-state">
            <span class="material-symbols-outlined">folder_off</span>
            <h3>No projects found</h3>
            <p>Try adjusting your search or create a new project.</p>
          </div>
        `;
        return;
      }

      visible.forEach((project, i) => {
        const totalFiles = project.folders.reduce((sum, folder) => sum + folder.files.length, 0);
        const formattedDate = project.dateCreated ? formatDate(project.dateCreated) : 'N/A';
        
        const div = document.createElement("div");
        div.className = "folder-item";
        div.innerHTML = `
          <div class="folder-header">
            <span class="material-symbols-outlined">folder</span>
            <div class="folder-title">${project.name}</div>
          </div>
          <div class="folder-description">${project.description || "No description provided"}</div>
          <div class="folder-stats">
            <div class="stat">
              <span class="material-symbols-outlined">person</span>
              <span>${project.owner}</span>
            </div>
            <div class="stat">
              <span class="material-symbols-outlined">calendar_today</span>
              <span>Created: ${formattedDate}</span>
            </div>
            <div class="stat">
              <span class="material-symbols-outlined">folder</span>
              <span>${project.folders.length} folders</span>
            </div>
            <div class="stat">
              <span class="material-symbols-outlined">description</span>
              <span>${totalFiles} files</span>
            </div>
          </div>
          <div class="folder-actions">
            <button onclick="addFolderToProject(${i})" title="Add Folder">
              <span class="material-symbols-outlined">create_new_folder</span>
            </button>
            <button class="edit-btn" onclick="openProjectDialog(true, ${i})" title="Edit Project">
              <span class="material-symbols-outlined">edit</span>
            </button>
            <button class="delete-btn" onclick="deleteProject(${i})" title="Delete Project">
              <span class="material-symbols-outlined">delete</span>
            </button>
          </div>
        `;
        container.appendChild(div);
      });
    }
    
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
    }

    function addFolderToProject(index) {
      // Use the predefined dialog instead of creating a new one
      const folderDialog = document.getElementById('folderDialog');
      const folderNameInput = document.getElementById('folderNameInput');
      const folderNameError = document.getElementById('folderNameError');
      
      // Clear previous values
      folderNameInput.value = '';
      folderNameError.style.display = 'none';
      
      // Store the current project index for later use
      folderDialog.dataset.projectIndex = index;
      
      // Show the dialog
      folderDialog.showModal();
    }
    
    function handleCreateFolder() {
      const folderDialog = document.getElementById('folderDialog');
      const folderNameInput = document.getElementById('folderNameInput');
      const folderNameError = document.getElementById('folderNameError');
      
      const folderName = folderNameInput.value.trim();
      const projectIndex = parseInt(folderDialog.dataset.projectIndex);
      
      if (!folderName) {
        folderNameError.style.display = 'block';
        return;
      }
      
      // Create a new folder with an empty files array
      projects[projectIndex].folders.push({
        folderName,
        files: []
      });
      
      saveProjects();
      renderProjects();
      
      // Close the dialog
      folderDialog.close();
      
      // Prompt to upload files to the newly created folder
      openFileUploadDialog(projectIndex, projects[projectIndex].folders.length - 1);
    }
    
    function openFileUploadDialog(projectIndex, folderIndex) {
      const fileUploadDialog = document.getElementById('fileUploadDialog');
      const selectedFilesDiv = document.getElementById('selectedFiles');
      const fileInput = document.getElementById('fileInput');
      
      // Clear previous selections
      fileInput.value = '';
      selectedFilesDiv.innerHTML = '';
      
      // Store the project and folder indices for later use
      fileUploadDialog.dataset.projectIndex = projectIndex;
      fileUploadDialog.dataset.folderIndex = folderIndex;
      
      // Update dialog title to show which folder we're uploading to
      const folderName = projects[projectIndex].folders[folderIndex].folderName;
      fileUploadDialog.querySelector('h2').textContent = `Upload Files to "${folderName}"`;
      
      // Show the dialog
      fileUploadDialog.showModal();
    }
    
    function handleFileSelection() {
      const fileInput = document.getElementById('fileInput');
      const selectedFilesDiv = document.getElementById('selectedFiles');
      
      selectedFilesDiv.innerHTML = '';
      
      if (fileInput.files.length > 0) {
        for (let i = 0; i < fileInput.files.length; i++) {
          const file = fileInput.files[i];
          const fileItem = document.createElement('div');
          fileItem.className = 'selected-file-item';
          
          // Determine file icon based on extension
          let fileIcon = 'description';
          const ext = file.name.split('.').pop().toLowerCase();
          if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {
            fileIcon = 'image';
          } else if (['doc', 'docx'].includes(ext)) {
            fileIcon = 'article';
          } else if (['xls', 'xlsx'].includes(ext)) {
            fileIcon = 'table';
          } else if (['pdf'].includes(ext)) {
            fileIcon = 'picture_as_pdf';
          }
          
          fileItem.innerHTML = `
            <span class="material-symbols-outlined">${fileIcon}</span>
            <span class="file-name">${file.name}</span>
            <span class="file-size">${formatFileSize(file.size)}</span>
          `;
          
          selectedFilesDiv.appendChild(fileItem);
        }
      }
    }
    
    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
      else return (bytes / 1048576).toFixed(1) + ' MB';
    }
    
    function handleFileUpload() {
      const fileUploadDialog = document.getElementById('fileUploadDialog');
      const fileInput = document.getElementById('fileInput');
      
      const projectIndex = parseInt(fileUploadDialog.dataset.projectIndex);
      const folderIndex = parseInt(fileUploadDialog.dataset.folderIndex);
      
      if (fileInput.files.length > 0) {
        // In a real application, we would upload the files to a server here
        // For this demo, we'll just add the filenames to the project data
        
        for (let i = 0; i < fileInput.files.length; i++) {
          projects[projectIndex].folders[folderIndex].files.push(fileInput.files[i].name);
        }
        
        saveProjects();
        renderProjects();
      }
      
      // Close the dialog
      fileUploadDialog.close();
    }

    // Toggle sidebar on mobile
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('open');
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadProjects();
      renderProjects();
      
      // Project dialog event listeners
      document.getElementById("saveBtn").addEventListener("click", handleSaveProject);
      
      // Folder dialog event listeners
      document.getElementById("createFolderBtn").addEventListener("click", handleCreateFolder);
      document.getElementById("cancelFolderBtn").addEventListener("click", () => {
        document.getElementById("folderDialog").close();
      });
      
      // File upload dialog event listeners
      document.getElementById("fileInput").addEventListener("change", handleFileSelection);
      document.querySelector(".file-select-btn").addEventListener("click", () => {
        document.getElementById("fileInput").click();
      });
      document.getElementById("uploadFilesBtn").addEventListener("click", handleFileUpload);
      document.getElementById("cancelUploadBtn").addEventListener("click", () => {
        document.getElementById("fileUploadDialog").close();
      });
      
      // Mobile menu toggle
      if (document.getElementById('menu-toggle')) {
        document.getElementById('menu-toggle').addEventListener('click', toggleSidebar);
      }
    });
  </script>
</body>
</html>