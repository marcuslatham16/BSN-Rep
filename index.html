<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document Repository Beta</title>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link href="style.css" rel="stylesheet" />
</head>
<body>
  <header>
    <div style="display: flex; justify-content: space-between; align-items: center; max-width: calc(100% - 240px); margin-left: auto;">
      <div style="display: flex; align-items: center; gap: 10px;">
        <span class="material-symbols-outlined">account_circle</span>
        <strong>User Name</strong>
      </div>
      <div style="display: flex; gap: 10px; align-items: center;">
        <div class="search-bar">
          <span class="material-symbols-outlined">search</span>
          <input type="text" id="searchInput" placeholder="Search projects or folders" oninput="renderProjects()" />
        </div>
        <button class="create-btn" onclick="openProjectDialog()">
          <span class="material-symbols-outlined">add_circle</span>
          New Project
        </button>
      </div>
    </div>
    <div class="breadcrumb" id="breadcrumb" style="max-width: calc(100% - 240px); margin-left: auto;">Home / Projects</div>
  </header>

  <div class="sidebar">
    <div class="sidebar-item"><span class="material-symbols-outlined">home</span> Home</div>
    <div class="sidebar-item"><span class="material-symbols-outlined">workspaces</span> Projects</div>
    <div class="sidebar-item"><span class="material-symbols-outlined">area_chart</span> Reports</div>
    <div class="sidebar-item"><span class="material-symbols-outlined">tune</span> Settings</div>
  </div>

  <div class="app main-content">
    <main id="project-grid" style="padding: 20px;"></main>
    <section id="folderDetails"></section>

    <dialog id="projectDialog">
      <h2>Create New Project</h2>
      <div>
        <input type="text" id="projectNameInput" placeholder="Enter project name" />
        <div id="nameError" class="error-message">Project name is required.</div>
      </div>
      <textarea id="projectDescInput" placeholder="Enter repository description"></textarea>
      <div>
        <input type="text" id="projectOwnerInput" placeholder="Enter project owner" />
        <div id="ownerError" class="error-message">Project owner is required.</div>
      </div>
      <div style="margin-top: 10px;">
        <button onclick="createProject()">Create</button>
        <button onclick="closeProjectDialog()">Cancel</button>
      </div>
    </dialog>
  </div>

  <script>
    window.projects = [];

    function openProjectDialog() {
      document.getElementById("projectDialog").showModal();
    }

    function closeProjectDialog() {
      document.getElementById("projectDialog").close();
      document.getElementById("projectNameInput").value = "";
      document.getElementById("projectDescInput").value = "";
      document.getElementById("projectOwnerInput").value = "";
    }

    function createProject() {
      const nameInput = document.getElementById("projectNameInput");
      const ownerInput = document.getElementById("projectOwnerInput");
      const nameError = document.getElementById("nameError");
      const ownerError = document.getElementById("ownerError");

      const name = nameInput.value.trim();
      const description = document.getElementById("projectDescInput").value.trim();
      const owner = ownerInput.value.trim();

      nameInput.classList.remove("input-error");
      ownerInput.classList.remove("input-error");
      nameError.style.display = "none";
      ownerError.style.display = "none";

      let hasError = false;
      if (!name) {
        nameInput.classList.add("input-error");
        nameError.style.display = "block";
        hasError = true;
      }
      if (!owner) {
        ownerInput.classList.add("input-error");
        ownerError.style.display = "block";
        hasError = true;
      }
      if (hasError) return;

      projects.push({ name, description, owner, folders: [] });
      document.getElementById("folderDetails").classList.remove("active");
      document.getElementById("project-grid").style.display = "block";
      renderProjects();
      closeProjectDialog();

      console.log("Project added:", { name, description, owner });
      console.log("Current projects:", projects);
    }

    function renderProjects() {
      const container = document.getElementById("project-grid");
      container.innerHTML = "";

      console.log("Rendering", projects.length, "projects");

      if (projects.length === 0) {
        container.innerHTML = "<p>No projects created yet.</p>";
        return;
      }

      projects.forEach((project, index) => {
        const div = document.createElement("div");
        div.className = "folder-item";
        div.innerHTML = `
          <div class="folder-title">${project.name}</div>
          <div class="folder-meta">${project.description}</div>
          <div class="folder-meta">Owner: ${project.owner}</div>
          <div class="folder-meta">${project.folders.length} folders</div>
          <button onclick="event.stopPropagation(); addFolderToProject(${index})">Add Folder</button>
        `;
        div.addEventListener("click", () => openFolderDetails(project));
        container.appendChild(div);
      });

      document.getElementById("folderDetails").classList.remove("active");
      document.getElementById("breadcrumb").textContent = "Home / Projects";
    }

    function addFolderToProject(projectIndex) {
      const folderName = prompt("Enter folder name:");
      const subfolders = parseInt(prompt("How many sub-folders?"), 10) || 0;
      const fileCount = parseInt(prompt("How many files?"), 10) || 0;
      const files = Array.from({ length: fileCount }, (_, i) => `File_${i + 1}.pdf`);

      if (folderName) {
        projects[projectIndex].folders.push({ folderName, subfolders, files });
        renderProjects();
      }
    }

    function openFolderDetails(project) {
      const detailSection = document.getElementById("folderDetails");
      detailSection.classList.add("active");
      document.getElementById("project-grid").innerHTML = "";
      document.getElementById("breadcrumb").textContent = `Home / Projects / ${project.name}`;

      const fileList = (project.folders || []).map(folder => {
        const files = folder.files.map(f => `<span class='file-badge'><span class='material-symbols-outlined'>description</span> ${f}</span>`).join("");
        return `<div class='folder-meta'><strong>${folder.folderName}</strong><br/>${folder.subfolders} sub-folder(s), ${folder.files.length} file(s)<br/>${files}</div><br/>`;
      }).join("");

      detailSection.innerHTML = `
        <h2>${project.name}</h2>
        <p><strong>Description:</strong> ${project.description}</p>
        <p><strong>Owner:</strong> ${project.owner}</p>
        <div>${fileList}</div>
        <br>
        <button onclick="renderProjects()">Back</button>
      `;
    }

    document.addEventListener("DOMContentLoaded", renderProjects);
  </script>
</body>
</html>
