<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document Repository</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,400..700,0..1,0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="sidebar" id="sidebar">
    <div class="logo">
      <span class="material-symbols-outlined">folder</span>
      <h2>DocRepo</h2>
    </div>
    <nav>
      <div class="sidebar-item active">
        <span class="material-symbols-outlined">home</span> 
        <span>Home</span>
      </div>
      <div class="sidebar-item">
        <span class="material-symbols-outlined">workspaces</span> 
        <span>Projects</span>
      </div>
      <div class="sidebar-item">
        <span class="material-symbols-outlined">area_chart</span> 
        <span>Reports</span>
      </div>
      <div class="sidebar-item">
        <span class="material-symbols-outlined">tune</span> 
        <span>Settings</span>
      </div>
    </nav>
  </div>

  <div class="content-wrapper">
    <header>
      <button id="menu-toggle" class="menu-toggle">
        <span class="material-symbols-outlined">menu</span>
      </button>
      
      <div class="header-inner">
        <div class="breadcrumb" id="breadcrumb">
          <span class="material-symbols-outlined">folder</span>
          Home / Projects
        </div>
        
        <div class="header-actions">
          <div class="search-bar">
            <span class="material-symbols-outlined">search</span>
            <input type="text" id="searchInput" placeholder="Search projects" oninput="renderProjects()" />
          </div>
          <button class="create-btn" onclick="openProjectDialog()" title="Create New Project">
            <span class="material-symbols-outlined">add</span>
          </button>
          <div class="user-info">
            <span class="material-symbols-outlined">account_circle</span>
            <div class="user-details">
              <strong>User Name</strong>
              <small>Admin</small>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="content-header">
        <h1>Projects</h1>
        <p class="subtitle">Manage your document repositories</p>
      </div>
      
      <div id="projects-container">
        <div id="project-grid"></div>
      </div>
    </main>
  </div>

  <dialog id="projectDialog">
    <h2 id="dialogTitle">New Project</h2>
    <form id="projectForm">
      <div class="form-group">
        <label for="projectNameInput">Project Name</label>
        <input type="text" id="projectNameInput" placeholder="Enter project name" />
        <div id="nameError" class="error-message">Project name is required.</div>
      </div>
      
      <div class="form-group">
        <label for="projectDescInput">Description</label>
        <textarea id="projectDescInput" placeholder="Enter description"></textarea>
      </div>
      
      <div class="form-group">
        <label for="projectOwnerInput">Project Owner</label>
        <input type="text" id="projectOwnerInput" placeholder="Enter owner name" />
        <div id="ownerError" class="error-message">Project owner is required.</div>
      </div>
      
      <div class="dialog-actions">
        <button type="button" id="saveBtn">
          <span class="material-symbols-outlined">save</span>
          <span id="saveBtnText">Create</span>
        </button>
        <button type="button" onclick="closeProjectDialog()">
          <span class="material-symbols-outlined">close</span>
          Cancel
        </button>
      </div>
    </form>
  </dialog>

  <script>
    const STORAGE_KEY = "projectRepository";
    let projects = [];
    let editingIndex = null;

    function loadProjects() {
      const data = localStorage.getItem(STORAGE_KEY);
      if (data) {
        projects = JSON.parse(data);
      } else {
        // Add sample projects for first-time users
        projects = [
          {
            name: "Marketing Campaign",
            description: "Files and assets for Q2 marketing campaign",
            owner: "Sarah Johnson",
            folders: [
              {
                folderName: "Social Media",
                files: ["facebook_ad.png", "instagram_post.psd", "twitter_banner.jpg"]
              }
            ]
          },
          {
            name: "Product Launch",
            description: "Documentation for the new product line",
            owner: "Michael Chen",
            folders: [
              {
                folderName: "Research",
                files: ["market_analysis.pdf", "competitor_review.docx"]
              }
            ]
          }
        ];
        saveProjects();
      }
    }

    function saveProjects() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(projects));
    }

    function openProjectDialog(isEdit = false, index = null) {
      document.getElementById("projectDialog").showModal();
      document.getElementById("dialogTitle").textContent = isEdit ? "Edit Project" : "Create New Project";
      document.getElementById("saveBtnText").textContent = isEdit ? "Save" : "Create";

      if (isEdit && projects[index]) {
        document.getElementById("projectNameInput").value = projects[index].name;
        document.getElementById("projectDescInput").value = projects[index].description;
        document.getElementById("projectOwnerInput").value = projects[index].owner;
        editingIndex = index;
      } else {
        clearForm();
        editingIndex = null;
      }
    }

    function closeProjectDialog() {
      document.getElementById("projectDialog").close();
      clearForm();
      editingIndex = null;
    }

    function clearForm() {
      document.getElementById("projectNameInput").value = "";
      document.getElementById("projectDescInput").value = "";
      document.getElementById("projectOwnerInput").value = "";
      document.getElementById("nameError").style.display = "none";
      document.getElementById("ownerError").style.display = "none";
    }

    function handleSaveProject() {
      const name = document.getElementById("projectNameInput").value.trim();
      const desc = document.getElementById("projectDescInput").value.trim();
      const owner = document.getElementById("projectOwnerInput").value.trim();

      const nameError = document.getElementById("nameError");
      const ownerError = document.getElementById("ownerError");

      nameError.style.display = name ? "none" : "block";
      ownerError.style.display = owner ? "none" : "block";

      if (!name || !owner) return;

      if (editingIndex !== null) {
        projects[editingIndex] = { ...projects[editingIndex], name, description: desc, owner };
      } else {
        projects.push({ 
          name, 
          description: desc, 
          owner, 
          folders: [] 
        });
      }

      saveProjects();
      renderProjects();
      closeProjectDialog();
    }

    function deleteProject(index) {
      const projectModal = document.createElement('dialog');
      projectModal.className = 'confirmation-dialog';
      
      projectModal.innerHTML = `
        <div class="confirmation-content">
          <span class="material-symbols-outlined warning-icon">warning</span>
          <h3>Delete Project?</h3>
          <p>Are you sure you want to delete "${projects[index].name}"? This action cannot be undone.</p>
          <div class="dialog-actions">
            <button class="delete-btn" id="confirmDelete">
              <span class="material-symbols-outlined">delete</span>
              Delete
            </button>
            <button class="secondary-btn" id="cancelDelete">
              <span class="material-symbols-outlined">close</span>
              Cancel
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(projectModal);
      projectModal.showModal();
      
      document.getElementById('confirmDelete').addEventListener('click', () => {
        projects.splice(index, 1);
        saveProjects();
        renderProjects();
        projectModal.close();
        document.body.removeChild(projectModal);
      });
      
      document.getElementById('cancelDelete').addEventListener('click', () => {
        projectModal.close();
        document.body.removeChild(projectModal);
      });
    }

    function renderProjects() {
      const container = document.getElementById("project-grid");
      const filter = document.getElementById("searchInput").value.toLowerCase();
      container.innerHTML = "";

      const visible = projects.filter(p => p.name.toLowerCase().includes(filter));

      if (!visible.length) {
        container.innerHTML = `
          <div class="empty-state">
            <span class="material-symbols-outlined">folder_off</span>
            <h3>No projects found</h3>
            <p>Try adjusting your search or create a new project.</p>
          </div>
        `;
        return;
      }

      visible.forEach((project, i) => {
        const totalFiles = project.folders.reduce((sum, folder) => sum + folder.files.length, 0);
        
        const div = document.createElement("div");
        div.className = "folder-item";
        div.innerHTML = `
          <div class="folder-header">
            <span class="material-symbols-outlined">folder</span>
            <div class="folder-title">${project.name}</div>
          </div>
          <div class="folder-description">${project.description || "No description provided"}</div>
          <div class="folder-stats">
            <div class="stat">
              <span class="material-symbols-outlined">person</span>
              <span>${project.owner}</span>
            </div>
            <div class="stat">
              <span class="material-symbols-outlined">folder</span>
              <span>${project.folders.length} folders</span>
            </div>
            <div class="stat">
              <span class="material-symbols-outlined">description</span>
              <span>${totalFiles} files</span>
            </div>
          </div>
          <div class="folder-actions">
            <button onclick="addFolderToProject(${i})" title="Add Folder">
              <span class="material-symbols-outlined">create_new_folder</span>
            </button>
            <button class="edit-btn" onclick="openProjectDialog(true, ${i})" title="Edit Project">
              <span class="material-symbols-outlined">edit</span>
            </button>
            <button class="delete-btn" onclick="deleteProject(${i})" title="Delete Project">
              <span class="material-symbols-outlined">delete</span>
            </button>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function addFolderToProject(index) {
      const folderDialog = document.createElement('dialog');
      folderDialog.className = 'folder-dialog';
      
      folderDialog.innerHTML = `
        <h2>New Folder</h2>
        <div class="form-group">
          <label for="folderNameInput">Folder Name</label>
          <input type="text" id="folderNameInput" placeholder="Enter folder name" />
        </div>
        <div class="form-group">
          <label>Files (one per line)</label>
          <textarea id="filesInput" placeholder="Enter file names (one per line)"></textarea>
        </div>
        <div class="dialog-actions">
          <button id="createFolderBtn">
            <span class="material-symbols-outlined">add</span>
            Create Folder
          </button>
          <button id="cancelFolderBtn">
            <span class="material-symbols-outlined">close</span>
            Cancel
          </button>
        </div>
      `;
      
      document.body.appendChild(folderDialog);
      folderDialog.showModal();
      
      document.getElementById('createFolderBtn').addEventListener('click', () => {
        const folderName = document.getElementById('folderNameInput').value.trim();
        const filesText = document.getElementById('filesInput').value.trim();
        
        if (!folderName) return;
        
        const files = filesText.split('\n')
          .map(f => f.trim())
          .filter(f => f.length > 0);
        
        projects[index].folders.push({
          folderName,
          files
        });
        
        saveProjects();
        renderProjects();
        folderDialog.close();
        document.body.removeChild(folderDialog);
      });
      
      document.getElementById('cancelFolderBtn').addEventListener('click', () => {
        folderDialog.close();
        document.body.removeChild(folderDialog);
      });
    }

    // Toggle sidebar on mobile
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('open');
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadProjects();
      renderProjects();
      document.getElementById("saveBtn").addEventListener("click", handleSaveProject);
      
      // Mobile menu toggle
      if (document.getElementById('menu-toggle')) {
        document.getElementById('menu-toggle').addEventListener('click', toggleSidebar);
      }
    });
  </script>
</body>
</html>